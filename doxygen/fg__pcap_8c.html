<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Flowgrind: src/fg_pcap.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="flowgrind.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Flowgrind
   </div>
   <div id="projectbrief">Advanced TCP traffic generator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fg__pcap_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">fg_pcap.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Packet capture support for the Flowgrind daemon.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &lt;sys/socket.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;netinet/in.h&gt;</code><br />
<code>#include &lt;netinet/in_systm.h&gt;</code><br />
<code>#include &lt;netinet/ip.h&gt;</code><br />
<code>#include &lt;arpa/inet.h&gt;</code><br />
<code>#include &lt;netinet/if_ether.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;syslog.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;pcap.h&gt;</code><br />
<code>#include &lt;netdb.h&gt;</code><br />
<code>#include &quot;<a class="el" href="debug_8h_source.html">debug.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fg__socket_8h_source.html">fg_socket.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fg__time_8h_source.html">fg_time.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fg__string_8h_source.html">fg_string.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fg__log_8h_source.html">fg_log.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="daemon_8h_source.html">daemon.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fg__pcap_8h_source.html">fg_pcap.h</a>&quot;</code><br />
</div>
<p><a href="fg__pcap_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a52e61302bf02a4a36d483908f3904f91"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#a52e61302bf02a4a36d483908f3904f91">PCAP_FILTER</a>&#160;&#160;&#160;&quot;tcp&quot;</td></tr>
<tr class="separator:a52e61302bf02a4a36d483908f3904f91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b9828e880b6f57c9c1a399923ec7102"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#a5b9828e880b6f57c9c1a399923ec7102">PCAP_PROMISC</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a5b9828e880b6f57c9c1a399923ec7102"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed6005eb1c40eef377731c5488c11c43"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#aed6005eb1c40eef377731c5488c11c43">PCAP_SNAPLEN</a>&#160;&#160;&#160;130</td></tr>
<tr class="separator:aed6005eb1c40eef377731c5488c11c43"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab986a493bb3fed05be028bf9c97fc8a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#ab986a493bb3fed05be028bf9c97fc8a4">fg_pcap_cleanup</a> (void *arg)</td></tr>
<tr class="memdesc:ab986a493bb3fed05be028bf9c97fc8a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup method to be called after dumping of the specified flow has finished.  <a href="#ab986a493bb3fed05be028bf9c97fc8a4">More...</a><br /></td></tr>
<tr class="separator:ab986a493bb3fed05be028bf9c97fc8a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5b67a433dfaab6960b30c8e310ff748"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#ac5b67a433dfaab6960b30c8e310ff748">fg_pcap_go</a> (struct <a class="el" href="structflow.html">flow</a> *<a class="el" href="structflow.html">flow</a>)</td></tr>
<tr class="memdesc:ac5b67a433dfaab6960b30c8e310ff748"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start a tcpdump to capture traffic of the provided flow.  <a href="#ac5b67a433dfaab6960b30c8e310ff748">More...</a><br /></td></tr>
<tr class="separator:ac5b67a433dfaab6960b30c8e310ff748"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb730b845773bb64036583cc3b3afcce"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#adb730b845773bb64036583cc3b3afcce">fg_pcap_init</a> (void)</td></tr>
<tr class="memdesc:adb730b845773bb64036583cc3b3afcce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize flowgrind's pcap library.  <a href="#adb730b845773bb64036583cc3b3afcce">More...</a><br /></td></tr>
<tr class="separator:adb730b845773bb64036583cc3b3afcce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b814f478e130f9f64e7861b669b3594"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#a4b814f478e130f9f64e7861b669b3594">fg_pcap_work</a> (void *arg)</td></tr>
<tr class="memdesc:a4b814f478e130f9f64e7861b669b3594"><td class="mdescLeft">&#160;</td><td class="mdescRight">Worker method performing actual packet capturing for the provided flow.  <a href="#a4b814f478e130f9f64e7861b669b3594">More...</a><br /></td></tr>
<tr class="separator:a4b814f478e130f9f64e7861b669b3594"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2be2f5d8859972dbfd0a842bf7946e61"><td class="memItemLeft" align="right" valign="top">static pcap_if_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#a2be2f5d8859972dbfd0a842bf7946e61">alldevs</a></td></tr>
<tr class="separator:a2be2f5d8859972dbfd0a842bf7946e61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad322ce690cf08b8bba5858339f0c8eeb"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#ad322ce690cf08b8bba5858339f0c8eeb">dumping</a></td></tr>
<tr class="separator:ad322ce690cf08b8bba5858339f0c8eeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41891cad090df07cd9360f1d8a9f1396"><td class="memItemLeft" align="right" valign="top">static char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a> [PCAP_ERRBUF_SIZE] = &quot;&quot;</td></tr>
<tr class="separator:a41891cad090df07cd9360f1d8a9f1396"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a649a3896609033e37aa38dba45018645"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structpthread__barrier__t.html">pthread_barrier_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fg__pcap_8c.html#a649a3896609033e37aa38dba45018645">pcap_barrier</a></td></tr>
<tr class="separator:a649a3896609033e37aa38dba45018645"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Packet capture support for the Flowgrind daemon. </p>

<p>Definition in file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a52e61302bf02a4a36d483908f3904f91"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCAP_FILTER&#160;&#160;&#160;&quot;tcp&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00067">67</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5b9828e880b6f57c9c1a399923ec7102"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCAP_PROMISC&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00070">70</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>

</div>
</div>
<a class="anchor" id="aed6005eb1c40eef377731c5488c11c43"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCAP_SNAPLEN&#160;&#160;&#160;130</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00064">64</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab986a493bb3fed05be028bf9c97fc8a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fg_pcap_cleanup </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cleanup method to be called after dumping of the specified flow has finished. </p>
<p>It closes the handle to the savefile and the handle to the device whose traffic was captured.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">arg</td><td>pointer to the flow whose dumping finished </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00125">125</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">/* signature of pthread_create() requires that all arguments must be</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">         * passed by reference and cast to (void *) */</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keyword">struct </span><a class="code" href="structflow.html">flow</a> *<a class="code" href="structflow.html">flow</a> = (<span class="keyword">struct </span>flow *) arg;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="fg__pcap_8c.html#ad322ce690cf08b8bba5858339f0c8eeb">dumping</a>)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <a class="code" href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a>(LOG_DEBUG, <span class="stringliteral">&quot;fg_pcap_cleanup() called for flow %d&quot;</span>, flow-&gt;<a class="code" href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">id</a>);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">if</span> (flow-&gt;<a class="code" href="structflow.html#a18729bf10731eab3f1f9cc99bf4dd91f">pcap_dumper</a>)</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                pcap_dump_close((pcap_dumper_t *)flow-&gt;<a class="code" href="structflow.html#a18729bf10731eab3f1f9cc99bf4dd91f">pcap_dumper</a>);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        flow-&gt;<a class="code" href="structflow.html#a18729bf10731eab3f1f9cc99bf4dd91f">pcap_dumper</a> = NULL;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span> (flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>)</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                pcap_close((pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a> = NULL;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <a class="code" href="fg__pcap_8c.html#ad322ce690cf08b8bba5858339f0c8eeb">dumping</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;}</div><div class="ttc" id="structflow_html_a18729bf10731eab3f1f9cc99bf4dd91f"><div class="ttname"><a href="structflow.html#a18729bf10731eab3f1f9cc99bf4dd91f">flow::pcap_dumper</a></div><div class="ttdeci">struct pcap_dumper_t * pcap_dumper</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00163">daemon.h:163</a></div></div>
<div class="ttc" id="debug_8h_html_ae420d5a1d63f99c6a2a386c4eea54250"><div class="ttname"><a href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a></div><div class="ttdeci">#define DEBUG_MSG(LVL, MSG,...)</div><div class="ttdoc">Print debug message to standard error. </div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00049">debug.h:49</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_ad322ce690cf08b8bba5858339f0c8eeb"><div class="ttname"><a href="fg__pcap_8c.html#ad322ce690cf08b8bba5858339f0c8eeb">dumping</a></div><div class="ttdeci">static bool dumping</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00082">fg_pcap.c:82</a></div></div>
<div class="ttc" id="structflow_html"><div class="ttname"><a href="structflow.html">flow</a></div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00073">daemon.h:73</a></div></div>
<div class="ttc" id="structflow_html_a61e91ee616f0dd7339cc2994239df3b1"><div class="ttname"><a href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">flow::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00075">daemon.h:75</a></div></div>
<div class="ttc" id="structflow_html_a0be175811fc9a0aeb14dfbb9b7ebd513"><div class="ttname"><a href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">flow::pcap_handle</a></div><div class="ttdeci">struct pcap_t * pcap_handle</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00162">daemon.h:162</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac5b67a433dfaab6960b30c8e310ff748"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fg_pcap_go </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structflow.html">flow</a> *&#160;</td>
          <td class="paramname"><em>flow</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start a tcpdump to capture traffic of the provided flow. </p>
<p>If the flow was not configured for tcp dumping or dumping is already in progress the method will do nothing and return immediately. Otherwise the method blocks until the actual capturing starts. In case an error occurs a log message is created.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">flow</td><td>the flow whose traffic should be captured </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00314">314</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;{</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">if</span> (!flow-&gt;<a class="code" href="structflow.html#abf86c8f5e99971c55bee93782f3c06b4">settings</a>.<a class="code" href="structflow__settings.html#a3aee86084eac437051355cce738de2ef">traffic_dump</a>)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="fg__pcap_8c.html#ad322ce690cf08b8bba5858339f0c8eeb">dumping</a>) {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;pcap: dumping already in progress on &quot;</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                        <span class="stringliteral">&quot;this host&quot;</span>);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <a class="code" href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a>(LOG_DEBUG, <span class="stringliteral">&quot;called fg_pcap_go() for flow %d&quot;</span>, flow-&gt;<a class="code" href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">id</a>);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <a class="code" href="fg__pcap_8c.html#ad322ce690cf08b8bba5858339f0c8eeb">dumping</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordtype">int</span> rc = pthread_create(&amp;flow-&gt;<a class="code" href="structflow.html#a07ae1fba61090712dae7c9fbe130a48a">pcap_thread</a>, NULL, <a class="code" href="fg__pcap_8c.html#a4b814f478e130f9f64e7861b669b3594">fg_pcap_work</a>,</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                (<span class="keywordtype">void</span>*)flow);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="comment">/* barrier: dump thread is ready (or aborted) */</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <a class="code" href="fg__barrier_8c.html#a85f92053b4d12aa94927b364b5b757d9">pthread_barrier_wait</a>(&amp;<a class="code" href="fg__pcap_8c.html#a649a3896609033e37aa38dba45018645">pcap_barrier</a>);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">if</span> (rc)</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;could not start pcap thread: %s&quot;</span>,</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                        strerror(rc) );</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div><div class="ttc" id="fg__log_8c_html_a2aea54bb4eab90a69510db34326d82f4"><div class="ttname"><a href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a></div><div class="ttdeci">void logging(int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="fg__log_8c_source.html#l00069">fg_log.c:69</a></div></div>
<div class="ttc" id="structflow_html_abf86c8f5e99971c55bee93782f3c06b4"><div class="ttname"><a href="structflow.html#abf86c8f5e99971c55bee93782f3c06b4">flow::settings</a></div><div class="ttdeci">struct flow_settings settings</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00083">daemon.h:83</a></div></div>
<div class="ttc" id="debug_8h_html_ae420d5a1d63f99c6a2a386c4eea54250"><div class="ttname"><a href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a></div><div class="ttdeci">#define DEBUG_MSG(LVL, MSG,...)</div><div class="ttdoc">Print debug message to standard error. </div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00049">debug.h:49</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a649a3896609033e37aa38dba45018645"><div class="ttname"><a href="fg__pcap_8c.html#a649a3896609033e37aa38dba45018645">pcap_barrier</a></div><div class="ttdeci">static pthread_barrier_t pcap_barrier</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00076">fg_pcap.c:76</a></div></div>
<div class="ttc" id="structflow__settings_html_a3aee86084eac437051355cce738de2ef"><div class="ttname"><a href="structflow__settings.html#a3aee86084eac437051355cce738de2ef">flow_settings::traffic_dump</a></div><div class="ttdeci">int traffic_dump</div><div class="ttdoc">Dump traffic using libpcap (option -M). </div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00204">common.h:204</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_ad322ce690cf08b8bba5858339f0c8eeb"><div class="ttname"><a href="fg__pcap_8c.html#ad322ce690cf08b8bba5858339f0c8eeb">dumping</a></div><div class="ttdeci">static bool dumping</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00082">fg_pcap.c:82</a></div></div>
<div class="ttc" id="structflow_html_a07ae1fba61090712dae7c9fbe130a48a"><div class="ttname"><a href="structflow.html#a07ae1fba61090712dae7c9fbe130a48a">flow::pcap_thread</a></div><div class="ttdeci">pthread_t pcap_thread</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00161">daemon.h:161</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a4b814f478e130f9f64e7861b669b3594"><div class="ttname"><a href="fg__pcap_8c.html#a4b814f478e130f9f64e7861b669b3594">fg_pcap_work</a></div><div class="ttdeci">static void * fg_pcap_work(void *arg)</div><div class="ttdoc">Worker method performing actual packet capturing for the provided flow. </div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00155">fg_pcap.c:155</a></div></div>
<div class="ttc" id="structflow_html_a61e91ee616f0dd7339cc2994239df3b1"><div class="ttname"><a href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">flow::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00075">daemon.h:75</a></div></div>
<div class="ttc" id="fg__barrier_8c_html_a85f92053b4d12aa94927b364b5b757d9"><div class="ttname"><a href="fg__barrier_8c.html#a85f92053b4d12aa94927b364b5b757d9">pthread_barrier_wait</a></div><div class="ttdeci">int pthread_barrier_wait(pthread_barrier_t *barrier)</div><div class="ttdoc">Synchronizes participating threads at the barrier referenced by barrier. </div><div class="ttdef"><b>Definition:</b> <a href="fg__barrier_8c_source.html#l00080">fg_barrier.c:80</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adb730b845773bb64036583cc3b3afcce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fg_pcap_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize flowgrind's pcap library. </p>
<p>This method fills internal structures on which other methods of this library depend. It is therefore crucial to call it before any call to other methods of this library.</p>
<dl class="section return"><dt>Returns</dt><dd>return 0 for success, or -1 for failure </dd></dl>

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00084">84</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="comment">/* initalize *alldevs for later use */</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">if</span> (pcap_findalldevs(&amp;<a class="code" href="fg__pcap_8c.html#a2be2f5d8859972dbfd0a842bf7946e61">alldevs</a>, <a class="code" href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a>) == -1) {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING,<span class="stringliteral">&quot;error in pcap_findalldevs: %s\n&quot;</span>, <a class="code" href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">for</span> (pcap_if_t *d = <a class="code" href="fg__pcap_8c.html#a2be2f5d8859972dbfd0a842bf7946e61">alldevs</a>; d; d = d-&gt;next) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="keywordtype">char</span> *devdes = NULL;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                <span class="keywordflow">if</span> (asprintf(&amp;devdes, <span class="stringliteral">&quot;%s: &quot;</span>, d-&gt;name) == -1)</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <span class="keywordflow">for</span> (pcap_addr_t *a = d-&gt;addresses; a; a = a-&gt;next) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                        <span class="keywordflow">if</span> (!a-&gt;addr)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                        <a class="code" href="fg__string_8c.html#a55a97149521d97f2e091a77a1f41ee05">asprintf_append</a>(&amp;devdes, <span class="stringliteral">&quot;a=%s&quot;</span>,</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                                        <a class="code" href="fg__socket_8c.html#aabb5038e27d6e7fedb3033885d851c3e">fg_nameinfo</a>(a-&gt;addr,</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                                                    <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr)));</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                        <span class="keywordflow">if</span> (a-&gt;next)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                <a class="code" href="fg__string_8c.html#a55a97149521d97f2e091a77a1f41ee05">asprintf_append</a>(&amp;devdes, <span class="stringliteral">&quot;, &quot;</span>);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <a class="code" href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a>(LOG_ERR, <span class="stringliteral">&quot;pcap: found pcapable device (%s)&quot;</span>, devdes);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                free(devdes);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        }</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DEBUG*/</span><span class="preprocessor"></span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <a class="code" href="fg__barrier_8c.html#ae3328293a058e9c0641dbdbdfff3761e">pthread_barrier_init</a>(&amp;<a class="code" href="fg__pcap_8c.html#a649a3896609033e37aa38dba45018645">pcap_barrier</a>, NULL, 2);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div><div class="ttc" id="fg__socket_8c_html_aabb5038e27d6e7fedb3033885d851c3e"><div class="ttname"><a href="fg__socket_8c.html#aabb5038e27d6e7fedb3033885d851c3e">fg_nameinfo</a></div><div class="ttdeci">const char * fg_nameinfo(const struct sockaddr *sa, socklen_t salen)</div><div class="ttdef"><b>Definition:</b> <a href="fg__socket_8c_source.html#l00374">fg_socket.c:374</a></div></div>
<div class="ttc" id="fg__log_8c_html_a2aea54bb4eab90a69510db34326d82f4"><div class="ttname"><a href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a></div><div class="ttdeci">void logging(int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="fg__log_8c_source.html#l00069">fg_log.c:69</a></div></div>
<div class="ttc" id="fg__string_8c_html_a55a97149521d97f2e091a77a1f41ee05"><div class="ttname"><a href="fg__string_8c.html#a55a97149521d97f2e091a77a1f41ee05">asprintf_append</a></div><div class="ttdeci">int asprintf_append(char **strp, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="fg__string_8c_source.html#l00098">fg_string.c:98</a></div></div>
<div class="ttc" id="debug_8h_html_ae420d5a1d63f99c6a2a386c4eea54250"><div class="ttname"><a href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a></div><div class="ttdeci">#define DEBUG_MSG(LVL, MSG,...)</div><div class="ttdoc">Print debug message to standard error. </div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00049">debug.h:49</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a2be2f5d8859972dbfd0a842bf7946e61"><div class="ttname"><a href="fg__pcap_8c.html#a2be2f5d8859972dbfd0a842bf7946e61">alldevs</a></div><div class="ttdeci">static pcap_if_t * alldevs</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00079">fg_pcap.c:79</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a649a3896609033e37aa38dba45018645"><div class="ttname"><a href="fg__pcap_8c.html#a649a3896609033e37aa38dba45018645">pcap_barrier</a></div><div class="ttdeci">static pthread_barrier_t pcap_barrier</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00076">fg_pcap.c:76</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a41891cad090df07cd9360f1d8a9f1396"><div class="ttname"><a href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a></div><div class="ttdeci">static char errbuf[PCAP_ERRBUF_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00073">fg_pcap.c:73</a></div></div>
<div class="ttc" id="fg__barrier_8c_html_ae3328293a058e9c0641dbdbdfff3761e"><div class="ttname"><a href="fg__barrier_8c.html#ae3328293a058e9c0641dbdbdfff3761e">pthread_barrier_init</a></div><div class="ttdeci">int pthread_barrier_init(pthread_barrier_t *barrier, const pthread_barrierattr_t *attr, unsigned count)</div><div class="ttdoc">Allocates resources required to use the barrier referenced by barrier. </div><div class="ttdef"><b>Definition:</b> <a href="fg__barrier_8c_source.html#l00037">fg_barrier.c:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4b814f478e130f9f64e7861b669b3594"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* fg_pcap_work </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Worker method performing actual packet capturing for the provided flow. </p>
<p>It prepares the flow for packet capturing by figuring out the correct device, constructing the pcap filter, etc. and finally starts capturing. Synchronizes with <a class="el" href="fg__pcap_8c.html#ac5b67a433dfaab6960b30c8e310ff748" title="Start a tcpdump to capture traffic of the provided flow. ">fg_pcap_go()</a> after initialization before starting capturing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">arg</td><td>pointer to the flow whose traffic should be captured </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00155">155</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;{</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">/* note: all the wierd casts in this function are completely useless,</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">         * execpt they cirumvent strange compiler warnings because of libpcap</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">         * typedef woo&#39;s */</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="comment">/* signature of pthread_create() requires that all arguments must be</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">         * passed by reference and cast to (void *) */</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keyword">struct </span><a class="code" href="structflow.html">flow</a> *<a class="code" href="structflow.html">flow</a> = (<span class="keyword">struct </span>flow *) arg;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a>(LOG_DEBUG, <span class="stringliteral">&quot;fg_pcap_thread() called for flow %d&quot;</span>, flow-&gt;<a class="code" href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">id</a>);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="comment">/* make sure all resources are released when finished */</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        pthread_cleanup_push(<a class="code" href="fg__pcap_8c.html#ab986a493bb3fed05be028bf9c97fc8a4">fg_pcap_cleanup</a>, (<span class="keywordtype">void</span>*) flow);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keyword">struct </span>addrinfo *ainf = NULL;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordtype">int</span> rc = getaddrinfo(flow-&gt;<a class="code" href="structflow.html#abf86c8f5e99971c55bee93782f3c06b4">settings</a>.<a class="code" href="structflow__settings.html#afcde8c9da11b85204968beb70542dadb">bind_address</a>, NULL, NULL, &amp;ainf);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">if</span> (rc) {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;getaddrinfo() failed (%s). Eliding &quot;</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                        <span class="stringliteral">&quot;packet capture for flow&quot;</span>, gai_strerror(rc));</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                <span class="keywordflow">goto</span> <span class="keyword">remove</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="comment">/* find appropriate (used for test) interface to dump */</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        pcap_if_t *d = NULL;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">for</span> (d = <a class="code" href="fg__pcap_8c.html#a2be2f5d8859972dbfd0a842bf7946e61">alldevs</a>; d; d = d-&gt;next) {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                <span class="keywordflow">for</span> (pcap_addr_t *a = d-&gt;addresses; a; a = a-&gt;next) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                        <span class="keywordflow">if</span> (!a-&gt;addr)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="fg__socket_8c.html#a11b1f7b2ab834edc2f2d8101d106e719">sockaddr_compare</a>(a-&gt;addr, ainf-&gt;ai_addr)) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                <a class="code" href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a>(LOG_NOTICE, <span class="stringliteral">&quot;pcap: data connection &quot;</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                          <span class="stringliteral">&quot;inbound from %s (%s)&quot;</span>, d-&gt;name,</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                          <a class="code" href="fg__socket_8c.html#aabb5038e27d6e7fedb3033885d851c3e">fg_nameinfo</a>(a-&gt;addr,</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                                      <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr)));</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                found = <span class="keyword">true</span>;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                        }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <span class="keywordflow">if</span> (found)</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">if</span> (!found) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;failed to determine interface for data &quot;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                        <span class="stringliteral">&quot;connection. No pcap support&quot;</span>);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                <span class="keywordflow">goto</span> <span class="keyword">remove</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a> = (<span class="keyword">struct </span>pcap_t *)pcap_open_live(</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                d-&gt;name, <a class="code" href="fg__pcap_8c.html#aed6005eb1c40eef377731c5488c11c43">PCAP_SNAPLEN</a>, <a class="code" href="fg__pcap_8c.html#a5b9828e880b6f57c9c1a399923ec7102">PCAP_PROMISC</a>,</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                                0, <a class="code" href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a>); <span class="comment">/* 0 = no read timeout */</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">if</span> (!flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;failed to init pcap on device %s: %s&quot;</span>,</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                        d-&gt;name, <a class="code" href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a>);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">goto</span> <span class="keyword">remove</span>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        uint32_t net = 0, mask = 0;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">if</span> (pcap_lookupnet(d-&gt;name, &amp;net, &amp;mask, <a class="code" href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a>) &lt; 0) {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;pcap: netmask lookup failed: %s&quot;</span>, <a class="code" href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                <span class="keywordflow">goto</span> <span class="keyword">remove</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="comment">/* we rely on a non-blocking dispatch loop */</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">if</span> (pcap_setnonblock((pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>, 1, <a class="code" href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a>) &lt; 0) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;pcap: failed to set non-blocking: %s&quot;</span>,</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                        <a class="code" href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">goto</span> <span class="keyword">remove</span>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="comment">/* compile filter */</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keyword">struct </span>bpf_program pcap_program;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">if</span> (pcap_compile((pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>,</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                         &amp;pcap_program, <a class="code" href="fg__pcap_8c.html#a52e61302bf02a4a36d483908f3904f91">PCAP_FILTER</a>, 1, mask) &lt; 0) {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;pcap: failed compiling filter &#39;%s&#39;: %s&quot;</span>,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                        <a class="code" href="fg__pcap_8c.html#a52e61302bf02a4a36d483908f3904f91">PCAP_FILTER</a>, pcap_geterr((pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>));</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="keywordflow">goto</span> <span class="keyword">remove</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="comment">/* attach filter to interface */</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">if</span> (pcap_setfilter((pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>,</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                           &amp;pcap_program) &lt; 0) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;pcap: failed to set filter: %s&quot;</span>,</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                        pcap_geterr((pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>));</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">goto</span> <span class="keyword">remove</span>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="comment">/* generate a nice filename */</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordtype">char</span> *dump_filename = NULL;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="comment">/* dir and prefix */</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="daemon_8h.html#a9e00b9f05b6a2247bb6c99ff3387a932">dump_dir</a>)</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <a class="code" href="fg__string_8c.html#a55a97149521d97f2e091a77a1f41ee05">asprintf_append</a>(&amp;dump_filename, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="daemon_8h.html#a9e00b9f05b6a2247bb6c99ff3387a932">dump_dir</a>);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="daemon_8h.html#a016095bb5b1fadba7bc57d2a0d1a75f8">dump_prefix</a>)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <a class="code" href="fg__string_8c.html#a55a97149521d97f2e091a77a1f41ee05">asprintf_append</a>(&amp;dump_filename, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="daemon_8h.html#a016095bb5b1fadba7bc57d2a0d1a75f8">dump_prefix</a>);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="comment">/* timestamp - we need to use the thread-safe version ctimenow_r() */</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordtype">char</span> timestamp[30] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <a class="code" href="fg__time_8c.html#a6e6839ffd004b08c17d7343741b486d0">ctimenow_r</a>(timestamp, <span class="keyword">sizeof</span>(timestamp), <span class="keyword">false</span>);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="fg__string_8c.html#a55a97149521d97f2e091a77a1f41ee05">asprintf_append</a>(&amp;dump_filename, <span class="stringliteral">&quot;%s&quot;</span>, timestamp);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">/* hostname */</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordtype">char</span> hostname[128] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordflow">if</span> (!gethostname(hostname, <span class="keyword">sizeof</span>(hostname)))</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                <a class="code" href="fg__string_8c.html#a55a97149521d97f2e091a77a1f41ee05">asprintf_append</a>(&amp;dump_filename, <span class="stringliteral">&quot;-%s&quot;</span>, hostname);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">/* interface and suffix */</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <a class="code" href="fg__string_8c.html#a55a97149521d97f2e091a77a1f41ee05">asprintf_append</a>(&amp;dump_filename, <span class="stringliteral">&quot;-%s.pcap&quot;</span>, d-&gt;name);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <a class="code" href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a>(LOG_NOTICE, <span class="stringliteral">&quot;dumping to \&quot;%s\&quot;&quot;</span>, dump_filename);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        flow-&gt;<a class="code" href="structflow.html#a18729bf10731eab3f1f9cc99bf4dd91f">pcap_dumper</a> = (<span class="keyword">struct </span>pcap_dumper_t *)pcap_dump_open(</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                (pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>, dump_filename);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        free(dump_filename);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordflow">if</span> (!flow-&gt;<a class="code" href="structflow.html#a18729bf10731eab3f1f9cc99bf4dd91f">pcap_dumper</a>) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;pcap: failed to open dump file writing: %s&quot;</span>,</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        pcap_geterr((pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>));</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="keywordflow">goto</span> <span class="keyword">remove</span>;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="comment">/* barrier: dump is ready */</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="fg__barrier_8c.html#a85f92053b4d12aa94927b364b5b757d9">pthread_barrier_wait</a>(&amp;<a class="code" href="fg__pcap_8c.html#a649a3896609033e37aa38dba45018645">pcap_barrier</a>);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="keywordtype">int</span> rc = pcap_dispatch((pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>, -1,</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                       &amp;pcap_dump, (u_char *)flow-&gt;<a class="code" href="structflow.html#a18729bf10731eab3f1f9cc99bf4dd91f">pcap_dumper</a>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <span class="keywordflow">if</span> (rc &lt; 0) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                        <a class="code" href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a>(LOG_WARNING, <span class="stringliteral">&quot;pcap_dispatch() failed. Packet &quot;</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                                <span class="stringliteral">&quot;dumping stopped for flow %d&quot;</span>, flow-&gt;<a class="code" href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">id</a>);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                        <span class="comment">/* cleanup automatically called */</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                        pthread_exit(0);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                <span class="keyword">struct </span>pcap_stat p_stats;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                pcap_stats((pcap_t *)flow-&gt;<a class="code" href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">pcap_handle</a>, &amp;p_stats);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* DEBUG */</span><span class="preprocessor"></span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                <a class="code" href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a>(LOG_NOTICE, <span class="stringliteral">&quot;pcap: finished dumping %d packets for &quot;</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                          <span class="stringliteral">&quot;flow %d&quot;</span>, rc, flow-&gt;<a class="code" href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">id</a>);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                <a class="code" href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a>(LOG_NOTICE, <span class="stringliteral">&quot;pcap: %d packets received by filter for &quot;</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                          <span class="stringliteral">&quot;flow %d&quot;</span>, p_stats.ps_recv, flow-&gt;<a class="code" href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">id</a>);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <a class="code" href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a>(LOG_NOTICE, <span class="stringliteral">&quot;pcap: %d packets dropped by kernel for &quot;</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                          <span class="stringliteral">&quot;flow %d&quot;</span>, p_stats.ps_drop, flow-&gt;<a class="code" href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">id</a>);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                <span class="keywordflow">if</span> (rc == 0)</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                        <span class="comment">/* if no packets are received try if we should cancel */</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                        pthread_testcancel();</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keyword">remove</span>: ;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        pthread_cleanup_pop(1);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <a class="code" href="fg__barrier_8c.html#a85f92053b4d12aa94927b364b5b757d9">pthread_barrier_wait</a>(&amp;<a class="code" href="fg__pcap_8c.html#a649a3896609033e37aa38dba45018645">pcap_barrier</a>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div><div class="ttc" id="fg__socket_8c_html_aabb5038e27d6e7fedb3033885d851c3e"><div class="ttname"><a href="fg__socket_8c.html#aabb5038e27d6e7fedb3033885d851c3e">fg_nameinfo</a></div><div class="ttdeci">const char * fg_nameinfo(const struct sockaddr *sa, socklen_t salen)</div><div class="ttdef"><b>Definition:</b> <a href="fg__socket_8c_source.html#l00374">fg_socket.c:374</a></div></div>
<div class="ttc" id="fg__time_8c_html_a6e6839ffd004b08c17d7343741b486d0"><div class="ttname"><a href="fg__time_8c.html#a6e6839ffd004b08c17d7343741b486d0">ctimenow_r</a></div><div class="ttdeci">const char * ctimenow_r(char *buf, size_t size, bool ns)</div><div class="ttdoc">Returns the current wall-clock time as null-terminated string. </div><div class="ttdef"><b>Definition:</b> <a href="fg__time_8c_source.html#l00047">fg_time.c:47</a></div></div>
<div class="ttc" id="fg__socket_8c_html_a11b1f7b2ab834edc2f2d8101d106e719"><div class="ttname"><a href="fg__socket_8c.html#a11b1f7b2ab834edc2f2d8101d106e719">sockaddr_compare</a></div><div class="ttdeci">char sockaddr_compare(const struct sockaddr *a, const struct sockaddr *b)</div><div class="ttdef"><b>Definition:</b> <a href="fg__socket_8c_source.html#l00389">fg_socket.c:389</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a5b9828e880b6f57c9c1a399923ec7102"><div class="ttname"><a href="fg__pcap_8c.html#a5b9828e880b6f57c9c1a399923ec7102">PCAP_PROMISC</a></div><div class="ttdeci">#define PCAP_PROMISC</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00070">fg_pcap.c:70</a></div></div>
<div class="ttc" id="daemon_8h_html_a016095bb5b1fadba7bc57d2a0d1a75f8"><div class="ttname"><a href="daemon_8h.html#a016095bb5b1fadba7bc57d2a0d1a75f8">dump_prefix</a></div><div class="ttdeci">char * dump_prefix</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00272">daemon.h:272</a></div></div>
<div class="ttc" id="structflow_html_a18729bf10731eab3f1f9cc99bf4dd91f"><div class="ttname"><a href="structflow.html#a18729bf10731eab3f1f9cc99bf4dd91f">flow::pcap_dumper</a></div><div class="ttdeci">struct pcap_dumper_t * pcap_dumper</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00163">daemon.h:163</a></div></div>
<div class="ttc" id="fg__log_8c_html_a2aea54bb4eab90a69510db34326d82f4"><div class="ttname"><a href="fg__log_8c.html#a2aea54bb4eab90a69510db34326d82f4">logging</a></div><div class="ttdeci">void logging(int priority, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="fg__log_8c_source.html#l00069">fg_log.c:69</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a52e61302bf02a4a36d483908f3904f91"><div class="ttname"><a href="fg__pcap_8c.html#a52e61302bf02a4a36d483908f3904f91">PCAP_FILTER</a></div><div class="ttdeci">#define PCAP_FILTER</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00067">fg_pcap.c:67</a></div></div>
<div class="ttc" id="fg__string_8c_html_a55a97149521d97f2e091a77a1f41ee05"><div class="ttname"><a href="fg__string_8c.html#a55a97149521d97f2e091a77a1f41ee05">asprintf_append</a></div><div class="ttdeci">int asprintf_append(char **strp, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="fg__string_8c_source.html#l00098">fg_string.c:98</a></div></div>
<div class="ttc" id="structflow_html_abf86c8f5e99971c55bee93782f3c06b4"><div class="ttname"><a href="structflow.html#abf86c8f5e99971c55bee93782f3c06b4">flow::settings</a></div><div class="ttdeci">struct flow_settings settings</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00083">daemon.h:83</a></div></div>
<div class="ttc" id="debug_8h_html_ae420d5a1d63f99c6a2a386c4eea54250"><div class="ttname"><a href="debug_8h.html#ae420d5a1d63f99c6a2a386c4eea54250">DEBUG_MSG</a></div><div class="ttdeci">#define DEBUG_MSG(LVL, MSG,...)</div><div class="ttdoc">Print debug message to standard error. </div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00049">debug.h:49</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a2be2f5d8859972dbfd0a842bf7946e61"><div class="ttname"><a href="fg__pcap_8c.html#a2be2f5d8859972dbfd0a842bf7946e61">alldevs</a></div><div class="ttdeci">static pcap_if_t * alldevs</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00079">fg_pcap.c:79</a></div></div>
<div class="ttc" id="daemon_8h_html_a9e00b9f05b6a2247bb6c99ff3387a932"><div class="ttname"><a href="daemon_8h.html#a9e00b9f05b6a2247bb6c99ff3387a932">dump_dir</a></div><div class="ttdeci">char * dump_dir</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00273">daemon.h:273</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a649a3896609033e37aa38dba45018645"><div class="ttname"><a href="fg__pcap_8c.html#a649a3896609033e37aa38dba45018645">pcap_barrier</a></div><div class="ttdeci">static pthread_barrier_t pcap_barrier</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00076">fg_pcap.c:76</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_a41891cad090df07cd9360f1d8a9f1396"><div class="ttname"><a href="fg__pcap_8c.html#a41891cad090df07cd9360f1d8a9f1396">errbuf</a></div><div class="ttdeci">static char errbuf[PCAP_ERRBUF_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00073">fg_pcap.c:73</a></div></div>
<div class="ttc" id="structflow__settings_html_afcde8c9da11b85204968beb70542dadb"><div class="ttname"><a href="structflow__settings.html#afcde8c9da11b85204968beb70542dadb">flow_settings::bind_address</a></div><div class="ttdeci">char bind_address[1000]</div><div class="ttdoc">The interface address for the flow (used by daemon). </div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00183">common.h:183</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_ab986a493bb3fed05be028bf9c97fc8a4"><div class="ttname"><a href="fg__pcap_8c.html#ab986a493bb3fed05be028bf9c97fc8a4">fg_pcap_cleanup</a></div><div class="ttdeci">void fg_pcap_cleanup(void *arg)</div><div class="ttdoc">Cleanup method to be called after dumping of the specified flow has finished. </div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00125">fg_pcap.c:125</a></div></div>
<div class="ttc" id="structflow_html"><div class="ttname"><a href="structflow.html">flow</a></div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00073">daemon.h:73</a></div></div>
<div class="ttc" id="fg__pcap_8c_html_aed6005eb1c40eef377731c5488c11c43"><div class="ttname"><a href="fg__pcap_8c.html#aed6005eb1c40eef377731c5488c11c43">PCAP_SNAPLEN</a></div><div class="ttdeci">#define PCAP_SNAPLEN</div><div class="ttdef"><b>Definition:</b> <a href="fg__pcap_8c_source.html#l00064">fg_pcap.c:64</a></div></div>
<div class="ttc" id="structflow_html_a61e91ee616f0dd7339cc2994239df3b1"><div class="ttname"><a href="structflow.html#a61e91ee616f0dd7339cc2994239df3b1">flow::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00075">daemon.h:75</a></div></div>
<div class="ttc" id="fg__barrier_8c_html_a85f92053b4d12aa94927b364b5b757d9"><div class="ttname"><a href="fg__barrier_8c.html#a85f92053b4d12aa94927b364b5b757d9">pthread_barrier_wait</a></div><div class="ttdeci">int pthread_barrier_wait(pthread_barrier_t *barrier)</div><div class="ttdoc">Synchronizes participating threads at the barrier referenced by barrier. </div><div class="ttdef"><b>Definition:</b> <a href="fg__barrier_8c_source.html#l00080">fg_barrier.c:80</a></div></div>
<div class="ttc" id="structflow_html_a0be175811fc9a0aeb14dfbb9b7ebd513"><div class="ttname"><a href="structflow.html#a0be175811fc9a0aeb14dfbb9b7ebd513">flow::pcap_handle</a></div><div class="ttdeci">struct pcap_t * pcap_handle</div><div class="ttdef"><b>Definition:</b> <a href="daemon_8h_source.html#l00162">daemon.h:162</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a2be2f5d8859972dbfd0a842bf7946e61"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pcap_if_t* alldevs</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00079">79</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad322ce690cf08b8bba5858339f0c8eeb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool dumping</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00082">82</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>

</div>
</div>
<a class="anchor" id="a41891cad090df07cd9360f1d8a9f1396"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char errbuf[PCAP_ERRBUF_SIZE] = &quot;&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00073">73</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>

</div>
</div>
<a class="anchor" id="a649a3896609033e37aa38dba45018645"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structpthread__barrier__t.html">pthread_barrier_t</a> pcap_barrier</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fg__pcap_8c_source.html#l00076">76</a> of file <a class="el" href="fg__pcap_8c_source.html">fg_pcap.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="fg__pcap_8c.html">fg_pcap.c</a></li>
    <li class="footer">Generated on Mon Sep 19 2016 13:59:32 for Flowgrind by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
